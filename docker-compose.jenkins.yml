# Fichier: docker-compose.jenkins.yml (Corrigé avec les variables d'environnement)
version: '3.8'

services:
  # Service 1: Laravel
  user_service:
    build:
      context: ./services/user-service
      dockerfile: Dockerfile
    container_name: user_service_test_app
    networks:
      - events_network
    # --- AJOUTÉ : Configuration pour les tests Laravel ---
    environment:
      - APP_KEY=base64:IgYfA8Xz1lUUQPItd/y/G9J0A9m9fP9hK/T2h/u3N8Y=
      - DB_CONNECTION=mysql
      - DB_HOST=db_mysql
      - DB_DATABASE=db_events_main
      - DB_USERNAME=user
      - DB_PASSWORD=password
      - CACHE_DRIVER=array
      - SESSION_DRIVER=array

  # Service 2: Symfony
  event_service:
    build:
      context: ./services/event-service
      dockerfile: Dockerfile
    container_name: event_service_test_app
    networks:
      - events_network
    # --- AJOUTÉ : Configuration pour les tests Symfony ---
    environment:
      # C'est la variable que Symfony lit
      - DATABASE_URL=mysql://user:password@db_mysql:3306/db_events?serverVersion=8.0

networks:
  events_network:
    external: true
    name: projet-gestion-evenements_events_network